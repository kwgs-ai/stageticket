<% @page_title = "舞台詳細" %>
<h1><%= @page_title %></h1>


<% if @stage.present? %>
  <table class="list">
    <thead>
    <tr>
      <th>舞台タイトル</th>
      <th>団体名</th>
      <th>日時</th>
      <th>午前・午後</th>
      <th>本文</th>
      <th>S席予約状況</th>
      <th>A席予約状況</th>
      <th>B席予約状況</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td style="text-align: right">
        <%= @stage.title %></td>
      <td>
        <%= @stage.actor.name %>
      </td>
      <td><%= @stage.date %></td>
      <td><%= @stage.time == 1 ? "午前" : "午後" %></td>
      <td><%= @stage.text %></td>
      <td><%= @stage.seats.where.not(reservation_id:nil).where('seat_type like ?', '%S%').count%>人</td>
      <td><%= @stage.seats.where.not(reservation_id:nil).where('seat_type like ?', '%A%').count%>人</td>
      <td><%= @stage.seats.where.not(reservation_id:nil).where('seat_type like ?', '%B%').count%>人</td>
    </tr>
    </tbody>
    </tbody>
  </table>
<% end %>
<%= form_for @stage do |form| %>
  <%= form.hidden_field :title %>
  <%= form.hidden_field :category_id %>
  <%= form.hidden_field :text %>
  <%= form.hidden_field :date %>
  <%= form.hidden_field :time %>
  <% @seats.each_with_index do |seat, i| %>
    <%= form.fields_for 'seats[]', seat do |fs| %>
      <%= fs.hidden_field :seat_prise, :value => seat.seat_prise %>
    <% end %>
  <% end %>
  <% if @stage.date >= Date.current %>
    <p>この舞台を承認する</p>
    <%= form.select :status, { '承認': 2, '拒否': 3 } %>
    <div><%= form.submit %></div>
  <% end %>
<% end %>
<%= link_to "戻る",:back %>