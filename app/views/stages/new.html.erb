<% @page_title = "公演の新規登録" %>
<h1><%= @page_title %></h1>

<% if @errors.present? %>
  <div id="errors">
    <h3>エラーがあります。</h3>
    <% @errors.each do |e| %>
      <li><%= e %></li>
    <% end %>
  </div>
<% end %>


<div class="register-method">
  <h3>新規登録規則</h3>
  <ul>
    <li>全部必須入力です</li>
    <li>タイトルは１文字以上２０文字以内、本文は１０文字以上４００文字以内入力してください</li>
    <li>今日から三日後以降から登録できます</li>
    <li>もうすでに承認された公演がある日時は登録できません</li>
    <li>席の値段は自然数で入力してください</li>
  </ul>
</div>

<%= form_for @form, model: @form, url: confirm_stages_path do |form| %>
  <%= render "form", form: form %>
  <div class="center-ok"><%= form.submit class: "edit-stage" %></div>

<% end %>

<script>
    var methods = {
        prise: function (value, element) { // メールアドレスの正規表現
            return this.optional(element) || /^[1-9][0-9]*$/i.test(value);
        },
        password: function (value, element) { // パスワードの正規表現
            return this.optional(element) || /^(?=.*?[a-z])(?=.*?\d)[a-z\d]{8,100}$/i.test(value);
        },
        date: function (value, element) { // パスワードの正規表現
            return this.optional(element) ||new Date() == value;
        },
    }
    // メソッドの追加
    $.each(methods, function (key) {
        $.validator.addMethod(key, this);
    });
    $("#new_stage_seats").validate({
        // ルール設定
        rules: {
            "stage_seats[title]": {
                required: true, // ニックネームの入力有無チェック
                maxlength: 200,
                minlength: 1,
            },
            "stage_seats[text]": {
                required: true, // ニックネームの入力有無チェック
                maxlength: 400,
                minlength: 10,
            },
            "stage_seats[date]": {
                required: true, // ニックネームの入力有無チェック
                date: true,
            },
            "stage_seats[seats][][seat_prise]": {
                required: true, // ニックネームの入力有無チェック
                prise:true
            }
        },
        // エラーメッセージの定義
        messages: {
            "stage_seats[title]": {
                required: "タイトルを入力してください",
                maxlength: "200文字以内で入力してください",
                minlength: "1文字以上で入力してください"
            },
            "stage_seats[text]": {
                required: "本文を入力してください",
                maxlength: "400文字以内で入力してください",
                minlength: "10文字以上で入力してください"
            },
            "stage_seats[date]": {
                required: "本文を入力してください",
                date: "4今日を含めて３日後以降を登録してください"
            },
            "stage_seats[seats][][seat_prise]": {
                required: "席の料金を入力してください",
                prise: "席の値段は自然数で入力してください"
            },
        },
        errorClass: "invalid", // バリデーションNGの場合に追加するクラス名の指定
        errorElement: "p", // エラーメッセージの要素種類の指定
        validClass: "valid", // バリデーションOKの場合に追加するクラス名の指定
    }).cancelSubmit = true;

    // 入力欄をフォーカスアウトしたときにバリデーションを実行
    $("#stage_seats_title,#stage_seats_text,#stage_seats_seats__seat_prise").keyup(function () {
        $(this).valid()

    });
    $("#stage_seats_title,#stage_seats_text,#stage_seats_seats__seat_prise").blur(function () {
        $(this).valid()

    });

</script>
